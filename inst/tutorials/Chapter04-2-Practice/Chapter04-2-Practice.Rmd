---
title: "Chapter 4-2 Practice"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(gradethis)
crime2 <- wooldridge::crime2
gradethis_setup()
tutorial_options(exercise.timelimit = 60)
knitr::opts_chunk$set(echo = FALSE)
```

## Exercise

1. Estimate the model from the previous practice exercises *with and without region variables*. Name your models `crime.lm1` (unrestricted model with regions) `crime.lmr` (restricted model without regions). 
$$\begin{align}ln(CrimeRate) ={} & \beta_0 + \beta_1ln(LawExpendPC) + \beta_2ln(IncomePC) + \beta_3ln(PopulationDensity) \\& + \beta_4West + \beta5Northeast + \beta_6South + u\end{align}$$  
2. Calculate the test statistic for the presence of risk-adjusted (controlling for other factors) regional differences in crime rates *by hand* using the restricted and unrestricted $R^2$. 
3. Calculate the corresponding p-value. 

```{r crime, exercise=TRUE, exercise.reveal_solution = TRUE}

```

```{r crime-solution}
crime.lm1 <- lm(log(crmrte) ~ log(lawexpc) + log(pcinc) + log(popden) + west + nrtheast + south, data = crime2)
crime.lmr <- lm(log(crmrte) ~ log(lawexpc) + log(pcinc) + log(popden), data = crime2)
r2.ur <- summary(crime.lm1)$r.squared 
r2.r <- summary(crime.lmr)$r.squared 
F <- (r2.ur-r2.r) / (1-r2.ur) * crime.lm1$df.residual/crime.lm1$rank
1-pf(F, crime.lm1$rank, crime.lm1$df.residual)
```

```{r crime-check}
grade_this({if(round(.result,4) != 0.4120) { 
    fail("The p-value should be about 0.412") }
  pass()
})
```
