---
title: "Chapter 6-1 Practice"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(gradethis)
library(marginaleffects)
library(stargazer)
hprice2 <- wooldridge::hprice2
hprice.lm1 <- lm(price ~ nox + crime + rooms + dist + stratio, data = hprice2)
hprice.lm2 <- lm(scale(price) ~ scale(nox) + scale(crime) + scale(rooms) + scale(dist) + scale(stratio), data = hprice2)
hprice.lm3 <- lm(scale(price) ~ 0 + scale(nox) + scale(crime) + scale(rooms) + scale(dist) + scale(stratio), data = hprice2)
lnhprice.lm1 <- lm(log(price) ~ log(nox) + log(crime) + rooms + I(rooms^2) + log(dist) + log(stratio), data = hprice2)
gradethis_setup()
tutorial_options(exercise.timelimit = 60)
knitr::opts_chunk$set(echo = FALSE)
```

## Crime and House Prices

### Standardized Coefficients

1. Estimate the following model using the `hprice2` dataset as `hprice.lm1`: 
$$Price = \beta_0 + \beta_1NO2 + \beta_2Crime + \beta_3Rooms + \beta4Employer\text{ }Distance + \beta_5Student\text{-}Teacher\text{ }Ratio + u \text{ : (hprice.lm1)}$$ 
2. Reestimate the same model *with and without a constant* using the `scale` function in your formula argument to estimate the standardized coefficients (`hprice.lm2` and `hprice.lm3`). 

```{r housePriceBetas, exercise=TRUE, exercise.reveal_solution = TRUE}

```

```{r housePriceBetas-solution}
hprice.lm1 <- lm(price ~ nox + crime + rooms + dist + stratio, data = hprice2)
hprice.lm2 <- lm(scale(price) ~ scale(nox) + scale(crime) + scale(rooms) + scale(dist) + scale(stratio), data = hprice2)
hprice.lm3 <- lm(scale(price) ~ 0 + scale(nox) + scale(crime) + scale(rooms) + scale(dist) + scale(stratio), data = hprice2)
stargazer(hprice.lm1, hprice.lm2, hprice.lm3, type = 'text')
```

```{r housePriceBetas-check}
grade_this({if (!inherits(.result, c("character"))) {
    fail("Your class of your answer should be a list of character strings.")}
  if (.result[8] != "nox                      -2,706.433***                                                        "){
    fail("The 'nox' coefficients don't look quite right.") }
  pass()
})
```

### Elasticities

3. Calculate the elasticities for the model estimated in (1) as `hprice.eyex1`.
4. Present the estimates in the same text table using `stargazer.`

```{r housePriceEYEX, exercise=TRUE, exercise.reveal_solution = TRUE}

# I'm giving you the code to make the stargazer table for free. 
stargazer(hprice.lm1,                                 # Tell it the structure of the original model
          coef = list(c(summary(hprice.eyex1)[[4]])), # Tell it where to find the elasticities
          se = list(c(summary(hprice.eyex1)[[5]])),   # Tell it where to find the se's
          type = 'text')                              # Remember to specify type
```

```{r housePriceEYEX-solution}
hprice.eyex1 <- marginaleffects(hprice.lm1, slope = 'eyex')
stargazer(hprice.lm1,                                 # Tell it the structure of the original model
          coef = list(c(summary(hprice.eyex1)[[4]])), # Tell it where to find the elasticities
          se = list(c(summary(hprice.eyex1)[[5]])),   # Tell it where to find the se's
          type = 'text')                              # Remember to specify type
```

```{r housePriceEYEX-check}
grade_this({if (!inherits(.result, c("character"))) {
    fail("Your class of your answer should be a list of character strings.")}
  if (.result[8] != "nox                           -0.062           "){
    fail("The 'nox' coefficients don't look quite right.") }
  pass()
})
```

### Log Transofrmation

1. Estimate the following model using `hprice2`.
$$ln(Price) = \beta_0 + \beta_1ln(NO2) + \beta_2ln(Crime) + \beta_3Rooms + \beta_4Rooms^2 + \beta5Employer\text{ }Distance + \beta_5Student\text{-}Teacher\text{ }Ratio + u \text{ : (lnhprice.lm1)}$$ 
2. Summarize this estimation using the $summary()$ function. 

```{r lnHousePrice, exercise=TRUE, exercise.reveal_solution = TRUE}

```

```{r lnHousePrice-solution}
lnhprice.lm1 <- lm(log(price) ~ log(nox) + log(crime) + rooms + I(rooms^2) + log(dist) + log(stratio), data = hprice2)
summary(lnhprice.lm1)
```

```{r lnHousePrice-hint}
# Remember that in order to use math operations (*, /, ^, etc.) within a formula, you need to wrap these terms within the I() function. 
lnhprice.lm1 <- lm(..., ...)
summary(lnhprice.lm1)
```

```{r lnHousePrice-check}
grade_this({if (!inherits(.result, c("summary.lm"))) {
    fail("Your class of your answer should be a summary of an lm object.")}
  if (round(.result[2,1]$coefficients,4) != -0.5320){
    fail("The 'log(nox)' coefficient doesn't look quite right.") }
  pass()
})
```
