---
title: "Appendix C-1 Practice"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
library(gradethis)
library(ggplot2)
gradethis_setup()
tutorial_options(exercise.reveal_solution = FALSE)
knitr::opts_chunk$set(echo = FALSE)
```

## Simple Regression Simulation

Let $X$ be a random variable that follows a exponential distribution with rate parameter $\lambda = 1$. 
Let $Y$ be a random variable that depends on $X$ according to the known linear structural population model $Y = \beta_0 + \beta_1X + u$, where: 
  
  + $\beta_0 = 2$
  + $\beta_1 = -0.5$
  + $u \sim N(0,1)$

Create a loop that does the following: 

1. Simulate samples of sizes 1-1000 for $X$, $u$, and $Y$.
2. Estimates the equation for Y to obtain $\hat\beta_0$ and $\hat\beta_1$ for each sample size.
3. Show the convergence of the sample estimate of $\beta_1$ towards the known population value of -1 for sample sizes 1 through 1000 by plotting the squared deviations from the true value. 

```{r llnPractice, exercise=TRUE, exercise.eval=TRUE}
set.seed(8675309)
X <- NULL 
u <- NULL
Y <- NULL
b1 <- NULL


```

```{r llnPractice-hint}

```

```{r llnPractice-solution}
set.seed(8675309)
X <- NULL 
u <- NULL
Y <- NULL
b1 <- NULL
for(i in 1:1000) {
  X = rexp(n = i, rate = 1)
  u = rnorm(n = i, mean = 0, sd = 1)
  Y = 2 - 0.5*X + u
  b1[i] <- lm(Y ~ X)$coefficients[2]
}
df <- data.frame(n = c(1:length(b1)), b1 = b1, v1 = (b1-(-0.5))^2)
ggplot() + 
  geom_line(data = df, aes(n, v1)) + 
  xlab("Sample Size") + 
  ylab("Squared Deviation")
```

```{r llnPractice-check}
grade_this({if (!inherits(.result, c("gg", "ggplot"))) {
    fail("Your class of your answer should be c('gg', 'ggplot').")}
  if (length(.result) != 9) { if (length(.result) != 11) {
    fail("Your table should have a length of 9 or 11.") } }
  pass()
})
```

## Regression CLT Practice

Using the same population parameters and variables as the previous exercise, create a loop that does the following: 

1. Simulate 1000 *distributions* of $\hat\beta_1$ with 1000 values estimates each from samples $X$, $u$, and $Y$ ranging from 1-1000. 
2. Estimates the equation for Y to obtain $\hat\beta_0$ and $\hat\beta_1$ for each sample size.
3. Plot the convergence of the distribution of $\hat\beta_1$ towards a normal distribution. 

```{r cltPractice, exercise=TRUE, exercise.eval=TRUE}
set.seed(8675309)


```

```{r cltPractice-hint}

```

```{r cltPractice-solution}
set.seed(8675309)
X <- NULL 
u <- NULL
Y <- NULL
b1 <- matrix(NA, nrow = 1000, ncol = 100)
for(i in 1:100) {
  for(j in 1:1000) {
    X <- rexp(n = i, rate = 1) 
    u <- rnorm(n = i, mean = 0, sd = 1)
    Y = 2 - 0.5*X + u
    b1[j, i] = lm(Y ~ X)$coefficients[2]
  }
}
plot(density(b1[,2]), xlim = c(-2, 1), ylim = c(0, 4))
lines(density(b1[,10]))
lines(density(b1[,30]))
lines(density(b1[,100]))
```

```{r cltPractice-check}
grade_code()
```
